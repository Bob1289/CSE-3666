\documentclass{article}
\usepackage[utf8]{inputenc}

\title{Homework 7}
\author{Benny Chen}
\date{\today}

\usepackage{color}
\usepackage{amsthm}
\usepackage{amssymb} 
\usepackage{amsmath}
\usepackage{listings}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage[table,xcdraw]{xcolor}
\usepackage[hidelinks]{hyperref}

\lstdefinelanguage[mips]{Assembler}{%
  % so listings can detect directives and register names
  alsoletter={.\$},
  % strings, characters, and comments
  morestring=[b]",
  morestring=[b]',
  morecomment=[l]\#,
  % instructions
  morekeywords={[1]abs,abs.d,abs.s,add,add.d,add.s,addi,addiu,addu,%
    and,andi,b,bc1f,bc1t,beq,beqz,bge,bgeu,bgez,bgezal,bgt,bgtu,%
    bgtz,ble,bleu,blez,blt,bltu,bltz,bltzal,bne,bnez,break,c.eq.d,%
    c.eq.s,c.le.d,c.le.s,c.lt.d,c.lt.s,ceil.w.d,ceil.w.s,clo,clz,%
    cvt.d.s,cvt.d.w,cvt.s.d,cvt.s.w,cvt.w.d,cvt.w.s,div,div.d,div.s,%
    divu,ecall,eret,floor.w.d,floor.w.s,j,jal,jalr,jr,l.d,l.s,la,lb,lbu,%
    ld,ldc1,lh,lhu,li,ll,lui,lw,lwc1,lwl,lwr,madd,maddu,mfc0,mfc1,%
    mfc1.d,mfhi,mflo,mov.d,mov.s,move,movf,movf.d,movf.s,movn,movn.d,%
    movn.s,movt,movt.d,movt.s,movz,movz.d,movz.s,msub,msubu,mtc0,mtc1,%
    mtc1.d,mthi,mtlo,mul,mul.d,mul.s,mulo,mulou,mult,multu,mulu,mv,neg,%
    neg.d,neg.s,negu,nop,nor,not,or,ori,rem,remu,rol,ror,round.w.d,%
    round.w.s,s.d,s.s,sb,sc,sd,sdc1,seq,sge,sgeu,sgt,sgtu,sh,sle,%
    sleu,sll,sllv,slt,slti,sltiu,sltu,sne,sqrt.d,sqrt.s,sra,srav,srl,%
    srlv,sub,sub.d,sub.s,subi,subiu,subu,sw,swc1,swl,swr,syscall,teq,%
    teqi,tge,tgei,tgeiu,tgeu,tlt,tlti,tltiu,tltu,tne,tnei,trunc.w.d,%
    trunc.w.s,ulh,ulhu,ulw,ush,usw,xor,xori},
  % assembler directives
  morekeywords={[2].align,.ascii,.asciiz,.byte,.data,.double,.extern,%
    .float,.globl,.half,.kdata,.ktext,.set,.space,.text,.word},
  % register names
  morekeywords={[3]\$0,\$1,\$2,\$3,\$4,\$5,\$6,\$7,\$8,\$9,\$10,\$11,%
    \$12,\$13,\$14,\$15,\$16,\$17,\$18,\$19,\$20,\$21,\$22,\$23,\$24,%
    \$25,\$26,\$27,\$28,\$29,\$30,\$31,%
    \$zero,\$at,\$v0,\$v1,\$a0,\$a1,\$a2,\$a3,\$t0,\$t1,\$t2,\$t3,\$t4,
    \$t5,\$t6,\$t7,\$s0,\$s1,\$s2,\$s3,\$s4,\$s5,\$s6,\$s7,\$t8,\$t9,%
    \$k0,\$k1,\$gp,\$sp,\$fp,\$ra},
}[strings,comments,keywords]

\definecolor{CommentGreen}{rgb}{0,.6,0}
\lstset{
  language=[mips]Assembler,
  escapechar=@, % include LaTeX code between `@' characters
  keepspaces,   % needed to preserve spacing with lstinline
  basicstyle=\small\ttfamily\bfseries,
  commentstyle=\color{CommentGreen},
  stringstyle=\color{cyan},
  showstringspaces=false,
  keywordstyle=[1]\color{blue},    % instructions
  keywordstyle=[2]\color{magenta}, % directives
  keywordstyle=[3]\color{red},     % registers
}

\lstdefinestyle{Python}{
    language        = Python,
    frame           = lines, 
    basicstyle      = \footnotesize,
    keywordstyle    = \color{blue},
    stringstyle     = \color{green},
    commentstyle    = \color{red}\ttfamily
}

\begin{document}

\maketitle

\section*{Problem 1}

\subsection*{Cycle 5}
\begin{center}
    \includegraphics[width=\textwidth]{images/cycle_5.png}
\end{center}

\subsection*{Cycle 6}
\begin{center}
    \includegraphics[width=\textwidth]{images/cycle_6.png}
\end{center}

\newpage

\section*{Problem 2}

\begin{table}[h]
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{|l|l|l|l|c|c|c|c|c|c|l|l|l|l|l|l|l|}
    \hline
    \textbf{}                                & \textbf{Instructions} & \multicolumn{1}{c|}{1}  & \multicolumn{1}{c|}{2}  & 3                     & 4                     & 5                     & 6                     & 7                     & 8                     & \multicolumn{1}{c|}{9}  & \multicolumn{1}{c|}{10}  & \multicolumn{1}{c|}{11}  & \multicolumn{1}{c|}{12}  & \multicolumn{1}{c|}{13} & \multicolumn{1}{c|}{14}  & \multicolumn{1}{c|}{15} \\ \hline
    \cellcolor[HTML]{FFFFFF}\textbf{Example} & ADD x1, x2, x3        & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             & SUB x1, x1, x2        &                         & \multicolumn{1}{c|}{IF} & ID                    & -                     & -                     & EX                    & MEM                   & WB                    &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             &                       &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{a)}                              & ADD x1, x2, x3        & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             & SUB x2, x1, x4        &                         & \multicolumn{1}{c|}{IF} & ID                    & -                     & -                     & EX                    & MEM                   & WB                    &                         &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{}                                & SW  x1, 0(x2)         &                         &                         & IF                    & -                     & -                     & ID                    & -                     & -                     & \multicolumn{1}{c|}{EX} & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB}  & \multicolumn{1}{c|}{}    &                         &                          &                         \\ \hline
                                             &                       &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{b)}                              & ADD x1, x2, x3        & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             & LW  x2, 0(x1)         &                         & \multicolumn{1}{c|}{IF} & ID                    & -                     & -                     & EX                    & MEM                   & WB                    &                         &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{}                                & LW  x3, 0(x1)         &                         &                         & IF                    & -                     & -                     & ID                    & EX                    & MEM                   & \multicolumn{1}{c|}{WB} &                          &                          &                          &                         &                          &                         \\ \hline
                                             & SUB x4, x2, x3        &                         &                         & \multicolumn{1}{l|}{} &                       &                       & IF                    & ID                    & -                     & \multicolumn{1}{c|}{-}  & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB}  &                         &                          &                         \\ \hline
                                             & SW  x4, 0(x3)         &                         &                         & \multicolumn{1}{l|}{} &                       &                       &                       & IF                    & -                     & \multicolumn{1}{c|}{-}  & \multicolumn{1}{c|}{ID}  & \multicolumn{1}{c|}{-}   & \multicolumn{1}{c|}{-}   & \multicolumn{1}{c|}{EX} & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} \\ \hline
                                             &                       &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{c)}                              & LW  x1, 0(x10)        & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             & SW  x1, 8(x10)        &                         & \multicolumn{1}{c|}{IF} & ID                    & -                     & -                     & EX                    & MEM                   & WB                    &                         &                          &                          &                          &                         &                          &                         \\ \hline
                                             & LW  x2, 0(x11)        &                         &                         & IF                    & -                     & -                     & ID                    & EX                    & MEM                   & \multicolumn{1}{c|}{WB} &                          &                          &                          &                         &                          &                         \\ \hline
    \textbf{}                                & ADD x3, x1, x2        &                         &                         & \multicolumn{1}{l|}{} &                       &                       & IF                    & ID                    & -                     & \multicolumn{1}{c|}{-}  & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB}  &                         &                          &                         \\ \hline
                                             & SUB x4, x2, x2        &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                       &                       & IF                    & -                     & \multicolumn{1}{c|}{-}  & \multicolumn{1}{c|}{ID}  & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} &                          &                         \\ \hline
    \end{tabular}%
    }
\end{table}

\section*{Problem 3}

\begin{table}[h]
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{|l|l|l|l|l|l|c|c|c|c|c|c|l|l|}
    \hline
    \textbf{}                                & \textbf{Instructions} & \textbf{Forward rs1}    & \textbf{Forward rs2}     & \multicolumn{1}{c|}{1}  & \multicolumn{1}{c|}{2}  & 3                     & 4                     & 5                     & 6                     & 7                     & 8                     & \multicolumn{1}{c|}{9}   & \multicolumn{1}{c|}{10} \\ \hline
    \cellcolor[HTML]{FFFFFF}\textbf{Example} & ADD x1, x2, x3        &                         &                          & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
                                             & SUB x1, x1, x2        & EX/MEM-\textgreater{}EX &                          &                         & \multicolumn{1}{c|}{IF} & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
                                             &                       &                         &                          &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
    \textbf{a)}                              & ADD x1, x2, x3        &                         &                          & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
                                             & SUB x2, x1, x4        & EX/MEM-\textgreater{}EX &                          &                         & \multicolumn{1}{c|}{IF} & ID                    & EX                    & MEM                   & WB                    &                       &                       &                          &                         \\ \hline
    \textbf{}                                & SW  x1, 0(x2)         & EX/MEM-\textgreater{}EX & MEM/WB-\textgreater{}EX  &                         &                         & IF                    & ID                    & EX                    & MEM                   & WB                    &                       & \multicolumn{1}{c|}{}    & \multicolumn{1}{c|}{}   \\ \hline
                                             &                       &                         &                          &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
    \textbf{b)}                              & ADD x1, x2, x3        &                         &                          & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
                                             & LW  x2, 0(x1)         & EX/MEM-\textgreater{}EX &                          &                         & \multicolumn{1}{c|}{IF} & ID                    & EX                    & MEM                   & WB                    &                       &                       &                          &                         \\ \hline
    \textbf{}                                & LW  x3, 0(x1)         & MEM/WB-\textgreater{}EX &                          &                         &                         & IF                    & ID                    & EX                    & MEM                   & WB                    &                       & \multicolumn{1}{c|}{}    &                         \\ \hline
                                             & SUB x4, x2, x3        &                         & MEM/WB-\textgreater{}EX  &                         &                         & \multicolumn{1}{l|}{} & IF                    & ID                    & -                     & EX                    & MEM                   & \multicolumn{1}{c|}{WB}  & \multicolumn{1}{c|}{}   \\ \hline
                                             & SW  x4, 0(x3)         &                         & EX/MEM-\textgreater{}EX  &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & -                     & ID                    & EX                    & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} \\ \hline
                                             &                       &                         &                          &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
    \textbf{c)}                              & LW  x1, 0(x10)        &                         &                          & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         \\ \hline
                                             & SW  x1, 8(x10)        &                         & MEM/WB-\textgreater{}MEM &                         & \multicolumn{1}{c|}{IF} & ID                    & EX                    & MEM                   & WB                    &                       &                       &                          &                         \\ \hline
                                             & LW  x2, 0(x11)        &                         &                          &                         &                         & IF                    & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} &                          &                         \\ \hline
    \textbf{}                                & ADD x3, x1, x2        &                         & MEM/WB-\textgreater{}EX  &                         &                         & \multicolumn{1}{l|}{} & IF                    & ID                    & -                     & EX                    & MEM                   & \multicolumn{1}{c|}{WB}  & \multicolumn{1}{c|}{}   \\ \hline
                                             & SUB x4, x2, x2        &                         &                          &                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & -                     & ID                    & EX                    & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} \\ \hline
    \end{tabular}%
    }
\end{table}

\newpage

\section*{Problem 4}

\subsection*{a)}
\begin{table}[h]
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{|l|l|c|c|c|c|c|c|c|c|c|c|c|c|c|c|l|l|l|l|}
    \hline
                                                & \multicolumn{1}{c|}{1}  & 2                     & 3                     & 4                     & 5                     & 6                     & 7                     & 8                     & 9                     & 10                    & 11                    & 12                    & 13                    & 14                    & 15                    & \multicolumn{1}{c|}{16} & \multicolumn{1}{c|}{17}  & \multicolumn{1}{c|}{18} & \multicolumn{1}{c|}{19} \\ \hline
    \cellcolor[HTML]{FFFFFF}I1: lw    t0, 0(s0) & \multicolumn{1}{c|}{IF} & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                         &                         \\ \hline
    I2: lw    t1, 0(s1)                         &                         & IF                    & ID                    & EX                    & MEM                   & WB                    &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                         &                         \\ \hline
    I3: add   t0, t0, t1                        &                         & \multicolumn{1}{l|}{} & IF                    & ID                    & -                     & -                     & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                         &                         \\ \hline
    I4: sw    t0, 0(s0)                         & \multicolumn{1}{c|}{}   &                       &                       & IF                    & -                     & -                     & ID                    & -                     & -                     & EX                    & MEM                   & WB                    &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                         &                         \\ \hline
    I5: addi  s0, s0, 4                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & -                     & -                     & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                         &                          &                         &                         \\ \hline
    I6: addi  s1, s1, 4                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                       &                       &                       & IF                    & ID                    & EX                    & MEM                   & WB                    &                       &                         &                          &                         &                         \\ \hline
    I7: addi  s2, s2, 1                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                       &                       &                       & IF                    & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{c|}{}   &                          &                         &                         \\ \hline
    I8: bne   s2, s3, I1                        & \multicolumn{1}{c|}{}   &                       &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                       &                       &                       & IF                    & ID                    & -                     & -                     & \multicolumn{1}{c|}{EX} & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} &                         \\ \hline
    I9:                                         &                         &                       &                       &                       &                       &                       &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & -                     & -                     & \multicolumn{1}{c|}{ID} & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{X}  & \multicolumn{1}{c|}{}   \\ \hline
    I1: lw    t0, 0(s0)                         &                         & \multicolumn{1}{l|}{} &                       &                       &                       &                       &                       &                       &                       & \multicolumn{1}{l|}{} &                       &                       &                       &                       &                       & \multicolumn{1}{c|}{}   & \multicolumn{1}{c|}{}    & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{}   \\ \hline
    \end{tabular}%
    }
\end{table}

\subsection*{b)}

There are 17 cycles per iteration. From that, there are 6 
stall cycles due to data hazards and 3 stall cycles due to control hazards.
\subsection*{c)}

We can schedule the instructions by moving Instructions 6 and 7 to the
position after Instruction 2. We would do this as Instruction 3 would be 
stalling for 2 cycles so instead of stalling we can put Instructions 6 and 7
to be executed first so after it is done we can execute Instruction 3 immediately.
This would also remove the data hazard in Instruction 8 leading to only 
3 stall cycles due to control hazards and 2 stall cycles due to data hazards.
In total this would lead to 13 cycles per iteration.

\subsection*{d)}

The speedup would be 17/13 = 1.31.

\section*{Problem 5}

\subsection*{a)}
\begin{table}[h]
        \resizebox{\textwidth}{!}{%
    \begin{tabular}{|l|l|c|c|l|l|c|c|c|c|c|c|l|l|l|l|l|l|}
    \hline
    \textbf{}                                   & \multicolumn{1}{c|}{1}  & 2                     & 3                     & \multicolumn{1}{c|}{4}   & \multicolumn{1}{c|}{5}   & 6                     & 7                     & 8                     & 9                     & 10                    & 11                    & \multicolumn{1}{c|}{12}  & \multicolumn{1}{c|}{13} & \multicolumn{1}{c|}{14} & \multicolumn{1}{c|}{15} & \multicolumn{1}{c|}{16}  & \multicolumn{1}{c|}{17} \\ \hline
    \cellcolor[HTML]{FFFFFF}I1: lw    t0, 0(s0) & \multicolumn{1}{c|}{IF} & ID                    & EX                    & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB}  & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         &                         &                         &                          &                         \\ \hline
    I2: lw    t1, 0(s1)                         &                         & IF                    & ID                    & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{MEM} & WB                    &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         &                         &                         &                          &                         \\ \hline
    I3: add   t0, t0, t1                        &                         & \multicolumn{1}{l|}{} & IF                    & \multicolumn{1}{c|}{ID}  & \multicolumn{1}{c|}{-}   & EX                    & MEM                   & WB                    & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                         &                         &                         &                          &                         \\ \hline
    I4: sw    t0, 0(s0)                         & \multicolumn{1}{c|}{}   &                       &                       & \multicolumn{1}{c|}{IF}  & \multicolumn{1}{c|}{-}   & ID                    & EX                    & MEM                   & WB                    &                       & \multicolumn{1}{l|}{} &                          &                         &                         &                         &                          &                         \\ \hline
    I5: addi  s0, s0, 4                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                          & IF                    & ID                    & EX                    & MEM                   & WB                    &                       &                          &                         &                         &                         &                          &                         \\ \hline
    I6: addi  s1, s1, 4                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                          & \multicolumn{1}{l|}{} & IF                    & ID                    & EX                    & MEM                   & WB                    & \multicolumn{1}{c|}{}    &                         &                         &                         &                          &                         \\ \hline
    I7: addi  s2, s2, 1                         &                         & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          &                          & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & ID                    & EX                    & MEM                   & \multicolumn{1}{c|}{WB}  & \multicolumn{1}{c|}{}   &                         &                         &                          &                         \\ \hline
    I8: bne   s2, s3, I1                        & \multicolumn{1}{c|}{}   &                       &                       &                          &                          &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & ID                    & EX                    & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} & \multicolumn{1}{c|}{}   & \multicolumn{1}{c|}{}   &                          & \multicolumn{1}{c|}{}   \\ \hline
    I9:                                         &                         &                       &                       &                          &                          &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & IF                    & ID                    & \multicolumn{1}{c|}{EX}  & \multicolumn{1}{c|}{X}  & \multicolumn{1}{c|}{}   & \multicolumn{1}{c|}{}   &                          & \multicolumn{1}{c|}{}   \\ \hline
    I1: lw    t0, 0(s0)                         &                         & \multicolumn{1}{l|}{} &                       &                          &                          &                       &                       & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} &                          & \multicolumn{1}{c|}{IF} & \multicolumn{1}{c|}{ID} & \multicolumn{1}{c|}{EX} & \multicolumn{1}{c|}{MEM} & \multicolumn{1}{c|}{WB} \\ \hline
    \end{tabular}%
    }
\end{table}

\subsection*{b)}

There are 12 cycles per iteration of the loop. 
There are a total of 1 stall cycle due to data hazard
and 3 stall cycles due to control hazard.
\subsection*{c)}

We can schedule the instructions so there is no hazard for Instruction 3.
We can do this by putting in Instruction 7 after Instruction 2. By putting
in Instruction 7 to run in the meantime, we can avoid the data hazard
for Instruction 3. In total there are 11 cycles per iteration of the loop.

\subsection*{d)}

The speedup would be 12/11 = 1.09.

\section*{Problem 6}

\includegraphics[width = \textwidth]{images/Q6.png}

\begin{enumerate}
    \item What is the CPI overhead from data hazards? \\ .3 * .1 * 1 = .03
    \item What is the CPI overhead from control hazards? \\ .25 * .6 * 3 = .45
    \item What is the average CPI of this application on Processor B? \\ 1 + .03 + .45 = 1.48
\end{enumerate}

\section*{Problem 7}

\includegraphics[width = \textwidth]{images/Q7.png}

\begin{enumerate}
    \item How many cycles does the operation take if x10 is 0? \\ 
    There would be 4 cycles as 1 cycle for the branch and 3 cycles for the stall.
    \item How many cycles does the operation take if x10 is not 0? \\  
    Since there is no control hazard, there would be 2 cycles, one for each instruction.
    \item If x10 is 0 80\% of the times when the operation is performed, how many cycles does the
    operation take on average? \\ 
    .8 * 4 + .2 * 2 = 3.6
\end{enumerate}

\end{document}